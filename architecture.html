<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NVIDIA Expert System Architecture</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0c0c0c 0%, #1a1a2e 50%, #16213e 100%);
            color: #fff;
            overflow-x: hidden;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            width: 100%;
            max-width: 1400px;
            margin: 0 auto;
        }

        .header-section {
            text-align: center;
            padding: 20px 0;
            position: relative;
        }

        .title {
            font-size: 2.5rem;
            font-weight: bold;
            background: linear-gradient(45deg, #76b900, #00d4aa);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: glow 2s ease-in-out infinite alternate;
            margin-bottom: 20px;
        }

        @keyframes glow {
            from { text-shadow: 0 0 20px #76b900; }
            to { text-shadow: 0 0 30px #00d4aa, 0 0 40px #00d4aa; }
        }

        .step-info-panel {
            background: rgba(0, 0, 0, 0.7);
            border-radius: 15px;
            padding: 20px;
            margin: 0 auto 30px auto;
            width: 90%;
            max-width: 1000px;
            border-left: 4px solid #76b900;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
        }

        .step-info-panel h3 {
            color: #76b900;
            margin-bottom: 10px;
            font-size: 1.4rem;
        }

        .step-info-panel p {
            line-height: 1.6;
            font-size: 1.1rem;
        }

        .architecture-container {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            grid-template-rows: repeat(3, auto);
            grid-gap: 25px;
            grid-template-areas:
                ". token-service ui-layer . ."
                "user . expert-system vertex-ai ."
                ". bigquery data-sources . ."
            ;
            position: relative;
            width: 100%;
            margin-bottom: 80px;
            align-items: center;
        }

        .component {
            border-radius: 15px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10;
            position: relative; /* Change from absolute */
        }

        .component:hover {
            transform: scale(1.05);
            border-color: #76b900;
            box-shadow: 0 0 20px rgba(118, 185, 0, 0.3);
        }

        .user { grid-area: user; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .ui-layer { grid-area: ui-layer; background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); }
        .expert-system { grid-area: expert-system; background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); font-size: 1.2rem; font-weight: bold; }
        .bigquery { grid-area: bigquery; background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); }
        .vertex-ai { grid-area: vertex-ai; background: linear-gradient(135deg, #fa709a 0%, #fee140 100%); }
        .data-sources { grid-area: data-sources; background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%); color: #333; }
        .token-service { grid-area: token-service; background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%); color: #333; }


        .arrow {
            position: absolute;
            height: 4px; /* Made thicker */
            background: linear-gradient(90deg, #76b900, #00d4aa);
            transform-origin: 0 50%;
            z-index: 5;
            opacity: 0;
            transition: opacity 0.5s ease;
            box-shadow: 0 0 10px rgba(118, 185, 0, 0.7);
        }

        .arrow.active {
            opacity: 1;
        }

        .arrow::after {
            content: '';
            position: absolute;
            right: -8px;
            top: -4px;
            width: 0;
            height: 0;
            border-left: 8px solid #76b900;
            border-top: 5px solid transparent;
            border-bottom: 5px solid transparent;
        }

        .flow-text {
            position: absolute;
            background: rgba(0, 0, 0, 0.8);
            color: #76b900;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.8rem;
            z-index: 100;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.5s ease;
        }

        .flow-text.active {
            opacity: 1;
        }

        .controls {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 15px;
            z-index: 1000;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 25px;
            background: linear-gradient(135deg, #76b900, #00d4aa);
            color: white;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(118, 185, 0, 0.3);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .step-info {
            position: fixed;
            top: 100px;
            right: 20px;
            background: linear-gradient(135deg, #5f72be 0%, #9921e8 100%);
            padding: 20px;
            border-radius: 15px;
            max-width: 300px;
            border-left: 4px solid #7a4ae6;
            opacity: 0;
            transform: translateX(100%);
            transition: all 0.9s ease;
            z-index: 100;
            box-shadow: 0 0 20px rgba(153, 33, 232, 0.5);
        }

        .step-info.active {
            opacity: 1;
            transform: translateX(0);
        }

        .pulse {
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .highlight {
            border-color: #00d4aa !important;
            box-shadow: 0 0 35px rgba(0, 212, 170, 0.7) !important;
            background: rgba(40, 40, 70, 0.7) !important; /* Brighter background */
        }

        .highlight h3, .highlight p, .highlight .code-snippet {
            color: #fff !important; /* Ensure text is visible during animation */
        }

        .code-snippet {
            background: rgba(0, 0, 0, 0.7);
            color: #00ff00;
            padding: 6px 8px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 0.7rem;
            margin-top: 8px;
            border-left: 2px solid #76b900;
            line-height: 1.2;
        }

        .component h3 {
            margin-bottom: 8px;
            font-size: 1rem;
        }

        .component p {
            font-size: 0.8rem;
            margin-bottom: 8px;
        }

        .data-flow {
            position: absolute;
            width: 8px;
            height: 8px;
            background: #76b900;
            border-radius: 50%;
            opacity: 0;
            z-index: 6;
        }

        .modal {
            display: none; /* Hidden by default */
            position: fixed; /* Stay in place */
            z-index: 2000; /* Sit on top */
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto; /* Enable scroll if needed */
            background-color: rgba(0,0,0,0.7);
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background: linear-gradient(145deg, #1f1f3a, #1a1a2e);
            margin: 15% auto;
            padding: 25px 30px;
            border: 1px solid #76b900;
            width: 80%;
            max-width: 600px;
            border-radius: 15px;
            position: relative;
            box-shadow: 0 8px 30px rgba(0,0,0,0.5);
            animation: slideIn 0.4s ease-out;
        }

        @keyframes slideIn {
            from {transform: translateY(-50px); opacity: 0;}
            to {transform: translateY(0); opacity: 1;}
        }

        .close-btn {
            color: #aaa;
            position: absolute;
            top: 10px;
            right: 20px;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            transition: color 0.3s ease;
        }

        .close-btn:hover,
        .close-btn:focus {
            color: #fff;
        }

        .modal-content h3 {
            color: #76b900;
            margin-top: 15px;
            margin-bottom: 10px;
            border-bottom: 1px solid #444;
            padding-bottom: 8px;
        }

        .modal-content ul {
            list-style: none;
            padding-left: 5px;
        }

        .modal-content li {
            margin-bottom: 8px;
            line-height: 1.6;
        }

        @media (max-width: 768px) {
            .architecture-container {
                min-height: 1000px;
            }
            
            .component {
                width: 140px;
                height: 100px;
                padding: 10px;
                font-size: 0.9rem;
            }
            
            .expert-system {
                width: 160px;
                height: 110px;
            }
            
            .user {
                top: 10%;
                left: 20px;
            }
            
            .ui-layer {
                top: 25%;
                left: 50%;
            }
            
            .token-service {
                top: 10%;
                right: 20px;
            }
            
            .expert-system {
                top: 45%;
                left: 50%;
            }
            
            .bigquery {
                top: 60%;
                right: 20px;
            }
            
            .vertex-ai {
                top: 75%;
                right: 20px;
            }
            
            .data-sources {
                bottom: 10%;
                left: 50%;
            }
            
            .step-info {
                position: relative;
                transform: none;
                opacity: 1;
                margin: 20px 0;
                max-width: none;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header-section">
            <h1 class="title">🚀 NVIDIA Expert System Architecture</h1>
            
            <div class="step-info-panel">
                <h3>System Overview</h3>
                <p>The NVIDIA Expert System processes user queries about GPU programming and CUDA by leveraging BigQuery's vector search capabilities and Vertex AI's generative models. The system retrieves relevant information from NVIDIA documentation and Stack Overflow, then generates comprehensive answers with performance metrics.</p>
            </div>
        </div>
        
        <div class="architecture-container">
            <!-- Components -->
            <div class="component token-service" data-step="1">
                <h3>🔑 Token Service</h3>
                <p>Cloud Run Token Vendor</p>
                <div class="code-snippet">REST API</div>
            </div>

            <div class="component ui-layer" data-step="0">
                <h3>🎨 Interactive UI</h3>
                <p>IPython Widgets + Rich Console</p>
                <div class="code-snippet">ipywidgets.Button</div>
            </div>

            <div class="component bigquery" data-step="3">
                <h3>📊 BigQuery</h3>
                <p>Vector Embeddings Storage</p>
                <div class="code-snippet">ML.GENERATE_EMBEDDING</div>
            </div>

            <div class="component user" data-step="0">
                <h3>👤 User</h3>
                <p>Asks GPU/CUDA Questions</p>
            </div>

            <div class="component expert-system" data-step="2">
                <h3>🧠 NVIDIA Expert System</h3>
                <p>Core Processing Engine</p>
                <div class="code-snippet">NVIDIAExpertSystem</div>
            </div>

            <div class="component vertex-ai" data-step="5">
                <h3>🤖 Vertex AI</h3>
                <p>Gemini-2.0-Flash</p>
                <div class="code-snippet">GenerativeModel</div>
            </div>

            <div class="component data-sources" data-step="4">
                <h3>📚 Data Sources</h3>
                <p>NVIDIA Docs + Stack Overflow</p>
                <div class="code-snippet">unified_nvidia_embeddings</div>
            </div>

            <!-- Data Flow Arrows -->
            <div class="arrow" id="arrow1"></div>
            <div class="arrow" id="arrow2"></div>
            <div class="arrow" id="arrow3"></div>
            <div class="arrow" id="arrow4"></div>
            <div class="arrow" id="arrow5"></div>
            <div class="arrow" id="arrow6"></div>
            <div class="arrow" id="arrow7"></div>
            <div class="arrow" id="arrow8"></div>
            <div class="arrow" id="arrow9"></div>
            <div class="arrow" id="arrow10"></div>
            
            <!-- Flow Labels -->
            <div class="flow-text" id="flowText1">Authentication Request</div>
            <div class="flow-text" id="flowText2">User Query</div>
            <div class="flow-text" id="flowText3">Access Token</div>
            <div class="flow-text" id="flowText4">Embedding Request</div>
            <div class="flow-text" id="flowText5">Vector Search</div>
            <div class="flow-text" id="flowText6">Relevant Documents</div>
            <div class="flow-text" id="flowText7">Generated Answer</div>
            <div class="flow-text" id="flowText8">Final Answer</div>
            <div class="flow-text" id="flowText9">Display to User</div>
            <div class="flow-text" id="flowText10">Return Answer</div>
        </div>

        <div class="controls">
            <button class="btn" id="startBtn" onclick="startAnimation()">▶️ Start Flow</button>
            <button class="btn" onclick="resetAnimation()">🔄 Reset</button>
            <button class="btn" onclick="showArchDetails()">📋 Details</button>
        </div>

        <div class="step-info" id="stepInfo">
            <h4 id="stepTitle">System Ready</h4>
            <p id="stepText">Click "Start Flow" to see how the NVIDIA Expert System processes queries!</p>
        </div>
    </div>

    <!-- The Modal -->
    <div id="detailsModal" class="modal">
        <div class="modal-content">
            <span class="close-btn">&times;</span>
            <h3>🔧 Core Components</h3>
            <ul>
                <li><b>Token Service:</b> Handles Google Cloud authentication</li>
                <li><b>Expert System:</b> Central processing engine for CUDA queries</li>
                <li><b>BigQuery:</b> Vector embeddings storage and similarity search</li>
                <li><b>Vertex AI:</b> Gemini-2.0-Flash for intelligent answer generation</li>
                <li><b>Data Sources:</b> Unified NVIDIA docs + Stack Overflow content</li>
            </ul>
            <h3>🚀 Key Features</h3>
            <ul>
                <li>Vector-based semantic search</li>
                <li>Real-time query processing</li>
                <li>Rich interactive UI with IPython widgets</li>
            </ul>
            <h3>⚡ Technologies</h3>
            <ul>
                <li>Google Cloud Platform</li>
                <li>Generative AI (Gemini)</li>
                <li>Python ecosystem (IPython, Rich)</li>
            </ul>
        </div>
    </div>

    <script>
        let currentStep = -1;
        let animationRunning = false;
        let animationTimeout;

        const steps = [
            {
                title: "Step 1: Data Sources",
                text: "NVIDIA documentation and Stack Overflow Q&A data are ingested into BigQuery, where they are transformed into vector embeddings and stored.",
                highlight: [".data-sources"],
                arrows: [],
                flowTexts: []
            },
            {
                title: "Step 2: Authentication Request",
                text: "The system requests an access token from the Token Service to authenticate with Google Cloud services.",
                highlight: [".expert-system", ".token-service"],
                arrows: ["arrow1"],
                flowTexts: ["flowText1"]
            },
            {
                title: "Step 3: Token Received",
                text: "The Token Service provides an access token that allows the system to access BigQuery and Vertex AI.",
                highlight: [".token-service", ".expert-system"],
                arrows: ["arrow2"],
                flowTexts: ["flowText3"]
            },
            {
                title: "Step 4: User Query Input",
                text: "A user submits a question about GPU programming through the Interactive UI.",
                highlight: [".user", ".ui-layer"],
                arrows: ["arrow3"],
                flowTexts: ["flowText2"]
            },
            {
                title: "Step 5: Query Processing",
                text: "The UI sends the user's question to the NVIDIA Expert System for processing.",
                highlight: [".ui-layer", ".expert-system"],
                arrows: ["arrow4"],
                flowTexts: ["flowText2"]
            },
            {
                title: "Step 6: Embedding Generation",
                text: "The Expert System sends the query to BigQuery to convert it into a vector embedding for similarity search.",
                highlight: [".expert-system", ".bigquery"],
                arrows: ["arrow5"],
                flowTexts: ["flowText4"]
            },
            {
                title: "Step 7: Vector Search",
                text: "BigQuery performs a vector similarity search across the unified NVIDIA documentation and Stack Overflow data.",
                highlight: [".bigquery", ".data-sources"],
                arrows: ["arrow6"],
                flowTexts: ["flowText5"]
            },
            {
                title: "Step 8: Context Retrieval",
                text: "Relevant documents are retrieved from the data sources and prepared as context for answer generation.",
                highlight: [".data-sources", ".bigquery", ".expert-system"],
                arrows: ["arrow6"],
                flowTexts: ["flowText6"]
            },
            {
                title: "Step 9: AI Answer Generation",
                text: "The Expert System sends the context and query to Vertex AI's Gemini model for intelligent answer generation.",
                highlight: [".expert-system", ".vertex-ai"],
                arrows: ["arrow7"],
                flowTexts: ["flowText6"]
            },
            {
                title: "Step 10: Response Delivery",
                text: "Vertex AI generates a comprehensive answer with code examples and sends it back through the system to the user interface.",
                highlight: [".vertex-ai", ".expert-system", ".ui-layer", ".user"],
                arrows: ["arrow8", "arrow9", "arrow10"],
                flowTexts: ["flowText7", "flowText8", "flowText9"]
            }
        ];

        // Initialize arrow positions when page loads
        window.addEventListener('load', function() {
            calculateArrowPositions();
            window.addEventListener('resize', calculateArrowPositions);
        });

        function calculateArrowPositions() {
            positionArrow("arrow1", ".expert-system", ".token-service", "flowText1");
            positionArrow("arrow2", ".token-service", ".expert-system", "flowText3");
            positionArrow("arrow3", ".user", ".ui-layer", "flowText2");
            positionArrow("arrow4", ".ui-layer", ".expert-system", "flowText2");
            positionArrow("arrow5", ".expert-system", ".bigquery", "flowText4");
            positionArrow("arrow6", ".bigquery", ".data-sources", "flowText5");
            positionArrow("arrow7", ".expert-system", ".vertex-ai", "flowText6");
            positionArrow("arrow8", ".vertex-ai", ".expert-system", "flowText7");
            positionArrow("arrow9", ".expert-system", ".ui-layer", "flowText8");
            positionArrow("arrow10", ".ui-layer", ".user", "flowText9");
        }

        function positionArrow(arrowId, fromSelector, toSelector, textId) {
            const fromEl = document.querySelector(fromSelector);
            const toEl = document.querySelector(toSelector);
            const arrow = document.getElementById(arrowId);

            if (!fromEl || !toEl || !arrow) return;

            const container = document.querySelector('.architecture-container');
            const fromRect = fromEl.getBoundingClientRect();
            const toRect = toEl.getBoundingClientRect();
            const containerRect = container.getBoundingClientRect();

            let fromX = fromRect.left + fromRect.width / 2 - containerRect.left;
            let fromY = fromRect.top + fromRect.height / 2 - containerRect.top;
            let toX = toRect.left + toRect.width / 2 - containerRect.left;
            let toY = toRect.top + toRect.height / 2 - containerRect.top;

            const dx = toX - fromX;
            const dy = toY - fromY;
            const distance = Math.sqrt(dx * dx + dy * dy);
            const angle = Math.atan2(dy, dx) * 180 / Math.PI;

            arrow.style.width = `${distance}px`;
            arrow.style.left = `${fromX}px`;
            arrow.style.top = `${fromY}px`;
            arrow.style.transform = `rotate(${angle}deg)`;
            arrow.style.transformOrigin = '0 50%';

            if (textId) {
                positionFlowText(textId, arrow, angle);
            }
        }

        function positionFlowText(textId, arrow, angle) {
            const text = document.getElementById(textId);
            if (!text) return;

            const arrowRect = arrow.getBoundingClientRect();
            const containerRect = document.querySelector('.architecture-container').getBoundingClientRect();

            const centerX = arrowRect.left - containerRect.left + arrowRect.width / 2;
            const centerY = arrowRect.top - containerRect.top + arrowRect.height / 2;

            text.style.left = `${centerX - text.offsetWidth / 2}px`;
            text.style.top = `${centerY - text.offsetHeight - 5}px`; // Position above the arrow

            // Keep text upright
            let textAngle = angle;
            if (textAngle > 90) textAngle -= 180;
            if (textAngle < -90) textAngle += 180;

            text.style.transform = `rotate(${textAngle}deg)`;
        }

        function startAnimation() {
            if (animationRunning) return;
            
            animationRunning = true;
            document.getElementById('startBtn').disabled = true;
            currentStep = -1;
            
            nextStep();
        }

        function nextStep() {
            // Clear previous highlights
            document.querySelectorAll('.component').forEach(comp => {
                comp.classList.remove('highlight', 'pulse');
            });
            
            document.querySelectorAll('.arrow').forEach(arrow => {
                arrow.classList.remove('active');
            });
            
            document.querySelectorAll('.flow-text').forEach(text => {
                text.classList.remove('active');
            });
            
            currentStep++;
            
            if (currentStep >= steps.length) {
                animationRunning = false;
                document.getElementById('startBtn').disabled = false;
                document.getElementById('stepInfo').classList.remove('active');
                return;
            }
            
            const step = steps[currentStep];
            
            // Update step info
            document.getElementById('stepTitle').textContent = step.title;
            document.getElementById('stepText').textContent = step.text;
            document.getElementById('stepInfo').classList.add('active');
            
            // Highlight components
            step.highlight.forEach(selector => {
                const element = document.querySelector(selector);
                if (element) {
                    element.classList.add('highlight', 'pulse');
                }
            });
            
            // Show arrows
            step.arrows.forEach(arrowId => {
                const arrow = document.getElementById(arrowId);
                if (arrow) {
                    arrow.classList.add('active');
                }
            });
            
            // Show flow text
            step.flowTexts.forEach(textId => {
                const text = document.getElementById(textId);
                if (text) {
                    text.classList.add('active');
                }
            });
            
            // Schedule next step
            let delay = 4000;
            // Steps 7, 8, 9, 10 are at indices 6, 7, 8, 9
            if (currentStep >= 6 && currentStep <= 9) {
                delay = 5500; // Add extra delay for the final steps
            }
            animationTimeout = setTimeout(nextStep, delay);
        }

        function resetAnimation() {
            if (animationTimeout) {
                clearTimeout(animationTimeout);
            }
            
            animationRunning = false;
            currentStep = -1;
            document.getElementById('startBtn').disabled = false;
            
            // Clear all highlights and animations
            document.querySelectorAll('.component').forEach(comp => {
                comp.classList.remove('highlight', 'pulse');
            });
            
            document.querySelectorAll('.arrow').forEach(arrow => {
                arrow.classList.remove('active');
            });
            
            document.querySelectorAll('.flow-text').forEach(text => {
                text.classList.remove('active');
            });
            
            document.getElementById('stepInfo').classList.remove('active');
        }

        function showArchDetails() {
            const modal = document.getElementById("detailsModal");
            modal.style.display = "block";

            const span = document.getElementsByClassName("close-btn")[0];
            span.onclick = function() {
                modal.style.display = "none";
            }

            window.onclick = function(event) {
                if (event.target == modal) {
                    modal.style.display = "none";
                }
            }
        }
    </script>
</body>
</html>